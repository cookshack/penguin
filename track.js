// phrasing from the Django Fakebook https://archive.org/details/fakebook-django/mode/2up

let beat, bpm, bpb, bps, d, drift, secs, spb, tempo, track, time

function setBpm
(b) {
  bpm = b
  bps = bpm / 60
  spb = 1 / bps
  d('bpm: ' + bpm)
  d('bps: ' + bps)
  d('spb: ' + spb)
}

d = console.log

setBpm(175) // according to mixxx, but changes, see tempo below
bpb = 4 // bar is 4 beats
// seconds to output
secs = spb * (12 + (8 * 3) + 10 + 8 + 4 + (8 * 2) + 2 + (8 + 8 + 5) + 4 + 8 + 10 + 8 + 4 + 6 /* a little extra */) * bpb

d('outputting ' + secs + 's')

track = { name: 'the penguin',
          bpb: bpb,
          length: secs,
          sections: [ { name: 'VAMP',
                        bg: '#FFD700',
                        phrases: [ { bars: 12 } ] },
                      { name: 'A',
                        bg: '#FF4500',
                        phrases: [ { bars: 8 } ] },
                      { name: 'A',
                        bg: '#FF4500',
                        phrases: [ { bars: 8 } ] },
                      { name: 'B',
                        bg: '#ADD8E6',
                        phrases: [ { bars: 8 } ] },
                      { name: 'B2 (with 1 extra 8)',
                        bg: '#ADD8E6',
                        phrases: [ { bars: 10 } ] },
                      { name: 'A',
                        bg: '#FF4500',
                        phrases: [ { bars: 8 } ] },
                      { name: 'BREAK',
                        bg: '#FFD700',
                        phrases: [ { bars: 4 } ] },
                      { name: 'C',
                        bg: '#90EE90',
                        phrases: [ { bars: 8 } ] },
                      { name: 'C',
                        bg: '#90EE90',
                        phrases: [ { bars: 8 } ] },
                      { name: '',
                        phrases: [ { bars: 2 } ] },
                      { name: 'SOLO',
                        phrases: [ { bars: 8 } ] },
                      { name: '',
                        phrases: [ { bars: 8 } ] },
                      { name: '',
                        phrases: [ { bars: 5 } ] },
                      { name: 'VAMP',
                        bg: '#FFD700',
                        phrases: [ { bars: 4 } ] },
                      { name: 'A',
                        bg: '#FF4500',
                        phrases: [ { bars: 8 } ] },
                      { name: 'B2 (with 1 extra 8)',
                        bg: '#ADD8E6',
                        phrases: [ { bars: 10 } ] },
                      { name: 'A',
                        bg: '#FF4500',
                        phrases: [ { bars: 8 } ] },
                      { name: 'VAMP',
                        bg: '#FFD700',
                        phrases: [ { bars: 10 } ] } ] }

drift = []
drift[(12 * bpb) + (8 * bpb) + (4 * bpb)] = -0.1 // 3rd 8 of 2nd A
drift[(12 * bpb) + (8 * bpb) + (6 * bpb)] = -0.1 // 4th 8 of 2nd A
drift[(12 * bpb) + (2 * 8 * bpb) + (7 * bpb)] = -0.1 // 2nd half of 4th 8 of 1st B
drift[(12 * bpb) + (3 * 8 * bpb) + (4 * bpb)] = -0.1 // 3rd 8 of 2nd B
drift[(12 * bpb) + (3 * 8 * bpb) + (6 * bpb)] = -0.1 // 4th 8 of 2nd B
drift[(12 * bpb) + (3 * 8 * bpb) + (9 * bpb)] = -0.1 // 2nd half of 5th 8 of 2nd B (the extra 8)
drift[(12 * bpb) + (3 * 8 * bpb) + (10 * bpb)] = -0.1 // 1st 8 of 3rd A
drift[(12 * bpb) + (3 * 8 * bpb) + (10 * bpb) + (3 * bpb)] = -0.1 // 2nd half of 2nd 8 of 3rd A
drift[(12 * bpb) + (3 * 8 * bpb) + (10 * bpb) + (4 * bpb)] = -0.1 // 3rd 8 of 3rd A
drift[(12 * bpb) + (3 * 8 * bpb) + (10 * bpb) + (6 * bpb)] = -0.1 // 4th 8 of 3rd A
drift[(12 * bpb) + (3 * 8 * bpb) + (10 * bpb) + (8 * bpb)] = -0.1 // start of Break
drift[(12 * bpb) + (3 * 8 * bpb) + (10 * bpb) + (8 * bpb) + (1 * bpb)] = -0.1 // 2nd half of 1st 8 of Break
drift[(12 * bpb) + (3 * 8 * bpb) + (10 * bpb) + (8 * bpb) + (2 * bpb)] = -0.1 // 2nd 8 of Break

// they speed up for C
tempo = []
tempo[(12 * bpb) + (3 * 8 * bpb) + (10 * bpb) + (8 * bpb) + (4 * bpb)] = 181
// and back down for the solo
tempo[(12 * bpb) + (3 * 8 * bpb) + (10 * bpb) + (8 * bpb) + (4 * bpb) + (2 * 8 * bpb)] = 175
// and a little up at the 2nd last A
tempo[(12 * bpb) + (3 * 8 * bpb) + (10 * bpb) + (8 * bpb) + (4 * bpb) + (2 * 8 * bpb) + ((2 + 8 + 8 + 5) * bpb) + (4 * bpb)] = 177
// and B2
tempo[(12 * bpb) + (3 * 8 * bpb) + (10 * bpb) + (8 * bpb) + (4 * bpb) + (2 * 8 * bpb) + ((2 + 8 + 8 + 5) * bpb) + (4 * bpb) + (8 * bpb)] = 178
// and last A
tempo[(12 * bpb) + (3 * 8 * bpb) + (10 * bpb) + (8 * bpb) + (4 * bpb) + (2 * 8 * bpb) + ((2 + 8 + 8 + 5) * bpb) + (4 * bpb) + (8 * bpb) + (8 * bpb)] = 179

0 && d(JSON.stringify(track, null, 2))

d('generating times for beats...')
track.beats = []
time = 0
beat = 0
for (let is = 0; is < track.sections.length; is++) {
  let section

  section = track.sections[is]
  for (let ip = 0; ip < section.phrases.length; ip++) {
    let phrase

    phrase = section.phrases[ip]
    for (let ibar = 0; ibar < phrase.bars; ibar++)
      for (let ib = 0; ib < track.bpb; ib++) {
        track.beats.push(time)
        beat++
        if (tempo[beat])
          setBpm(tempo[beat])
        if (drift[beat])
          time += drift[beat]
        time += spb

      }
  }
}
d('generating times for beats: done')
0 && d(JSON.stringify(track, null, 2))

if (0)
  // cd ~/src/penguin && aubiotrack -i penguin.mp3
  track.beats = [ 0,
                  1 * spb,
                  2 * spb,
                  3 * spb,
                  4 * spb,
                  //
                  1.684739,
                  2.032948, // 8
                  2.381156,
                  2.729365,
                  3.199456,
                  3.539841,
                  3.880250,
                  4.220635,
                  4.781338,
                  5.466576, // 8
                  6.160884,
                  6.844830,
                  8.028413,
                  8.711950,
                  9.414852,
                  10.099614,
                  10.789660,
                  11.474400,
                  12.182585,
                  12.863764,
                  13.554943,
                  14.235556,
                  14.919841,
                  15.599342,
                  16.278843,
                  16.982244,
                  17.664398,
                  18.336847,
                  19.015102,
                  19.672947,
                  20.343855,
                  20.985987,
                  21.315420,
                  21.644852,
                  21.974285,
                  22.307392,
                  22.634241,
                  22.961088,
                  23.287960,
                  23.614807,
                  23.878254,
                  24.204988,
                  24.531723,
                  24.858458,
                  25.185192,
                  25.548412,
                  25.874876,
                  26.201361,
                  26.527845,
                  26.892359,
                  27.220589,
                  27.548843,
                  27.877075,
                  28.205328,
                  28.619205,
                  28.947483,
                  29.275759,
                  29.604036,
                  29.954920,
                  30.282721,
                  30.610521,
                  30.938322,
                  31.285715,
                  31.613356,
                  31.940998,
                  32.268639,
                  32.596260,
                  32.940659,
                  33.267097,
                  33.593559,
                  33.920021,
                  34.312698,
                  34.639751,
                  34.966824,
                  35.293877,
                  35.620953,
                  35.969341,
                  36.296032,
                  36.622746,
                  36.949455,
                  37.286419,
                  37.611767,
                  37.937119,
                  38.262470,
                  38.587845,
                  38.784332,
                  39.110317,
                  39.436302,
                  39.762291,
                  40.088253,
                  40.514240,
                  40.843037,
                  41.171837,
                  41.500610,
                  41.850521,
                  42.180725,
                  42.510929,
                  42.841110,
                  43.218323,
                  43.549683,
                  43.881020,
                  44.212357,
                  44.543720,
                  44.888210,
                  45.217300,
                  45.546417,
                  45.875511,
                  46.250137,
                  46.579681,
                  46.909229,
                  47.238777,
                  47.585556,
                  47.913921,
                  48.242290,
                  48.570656,
                  48.899025,
                  49.327778,
                  49.657822,
                  49.987892,
                  50.317959,
                  50.698231,
                  51.027756,
                  51.357258,
                  51.686779,
                  52.037731,
                  52.366371,
                  52.695034,
                  53.023674,
                  53.352314,
                  53.734898,
                  54.064106,
                  54.393333,
                  54.722538,
                  55.063107,
                  55.390999,
                  55.718910,
                  56.046825,
                  56.374741,
                  56.743084,
                  57.071201,
                  57.399296,
                  57.727413,
                  58.280022,
                  58.942268,
                  59.734398,
                  60.394058,
                  61.054333,
                  61.709908,
                  62.365509,
                  63.033970,
                  63.687462,
                  64.065079,
                  64.390472,
                  64.715851,
                  65.041222,
                  65.366600,
                  65.601448,
                  65.925598,
                  66.249748,
                  66.573898,
                  66.908302,
                  67.233467,
                  67.558640,
                  67.883812,
                  68.208977,
                  68.594215,
                  68.918709,
                  69.243172,
                  69.567665,
                  69.915100,
                  70.239754,
                  70.564400,
                  70.889046,
                  71.213699,
                  71.545624,
                  71.869316,
                  72.193016,
                  72.516708,
                  72.852928,
                  73.177116,
                  73.501289,
                  73.825485,
                  74.149658,
                  74.501312,
                  74.824966,
                  75.148598,
                  75.472244,
                  75.926529,
                  76.252815,
                  76.579094,
                  76.905373,
                  77.231674,
                  77.733223,
                  78.057503,
                  78.381790,
                  78.706078,
                  79.201248,
                  79.516533,
                  79.831795,
                  80.147049,
                  80.418411,
                  80.743698,
                  81.068977,
                  81.394264,
                  81.719543,
                  82.035851,
                  82.360657,
                  82.685486,
                  83.010292,
                  83.386032,
                  83.711205,
                  84.036369,
                  84.361542,
                  84.686714,
                  85.028755,
                  85.354126,
                  85.679527,
                  86.004898,
                  86.331085,
                  86.655106,
                  86.979141,
                  87.303154,
                  87.627190,
                  87.822990,
                  88.147141,
                  88.471268,
                  88.795418,
                  89.119568,
                  89.465286,
                  89.789185,
                  90.113060,
                  90.436958,
                  90.818527,
                  91.143898,
                  91.469276,
                  91.794647,
                  92.120026,
                  92.352219,
                  92.677689,
                  93.003174,
                  93.328636,
                  93.803291,
                  94.129662,
                  94.456009,
                  94.782379,
                  95.162384,
                  95.489044,
                  95.815689,
                  96.142334,
                  96.469002,
                  97.189278,
                  97.852158,
                  98.519119,
                  99.180275,
                  99.853874,
                  100.514351,
                  101.121292,
                  101.783310,
                  102.445328,
                  102.799049,
                  103.131813,
                  103.464577,
                  103.797348,
                  104.293922,
                  104.626511,
                  104.959091,
                  105.291679,
                  105.631653,
                  105.960770,
                  106.289886,
                  106.619026,
                  106.948143,
                  107.326942,
                  107.657074,
                  107.987190,
                  108.317322,
                  108.635689,
                  108.965645,
                  109.295624,
                  109.625603,
                  109.955582,
                  110.420341,
                  110.753036,
                  111.085739,
                  111.418434,
                  111.807457,
                  112.141586,
                  112.475716,
                  112.809845,
                  113.175240,
                  113.511406,
                  113.847549,
                  114.183716,
                  114.545197,
                  114.881409,
                  115.217621,
                  115.553810,
                  115.890022,
                  116.141769,
                  116.477959,
                  116.814148,
                  117.150314,
                  117.622498,
                  117.958054,
                  118.293625,
                  118.629204,
                  118.994217,
                  119.329544,
                  119.664879,
                  120.000206,
                  120.335533,
                  120.683426,
                  121.017799,
                  121.352196,
                  121.686577,
                  122.080978,
                  122.416618,
                  122.752243,
                  123.087891,
                  123.458389,
                  123.793991,
                  124.129570,
                  124.465172,
                  124.800774,
                  125.159752,
                  125.495644,
                  125.831520,
                  126.167389,
                  126.527596,
                  126.862564,
                  127.197525,
                  127.532494,
                  127.894196,
                  128.228836,
                  128.563477,
                  128.898102,
                  129.232742,
                  129.600540,
                  129.935608,
                  130.270676,
                  130.605743,
                  130.978775,
                  131.315445,
                  131.652130,
                  131.988800,
                  132.344421,
                  132.679886,
                  133.015335,
                  133.350800,
                  133.686234,
                  134.033417,
                  134.367264,
                  134.701096,
                  135.034927,
                  135.369202,
                  135.700729,
                  136.032227,
                  136.363739,
                  136.695267,
                  136.954651,
                  137.284851,
                  137.615051,
                  137.945267,
                  138.284042,
                  138.613632,
                  138.943192,
                  139.272766,
                  139.602341,
                  139.970001,
                  140.301498,
                  140.632996,
                  140.964493,
                  141.302246,
                  141.630356,
                  141.958496,
                  142.286621,
                  142.614746,
                  143.009476,
                  143.338959,
                  143.668442,
                  143.997910,
                  144.332474,
                  144.658997,
                  144.985504,
                  145.312042,
                  145.655991,
                  145.982788,
                  146.309570,
                  146.636353,
                  146.963150,
                  147.164780,
                  147.491898,
                  147.819031,
                  148.146149,
                  148.473267,
                  148.906464,
                  149.235077,
                  149.563690,
                  149.892288,
                  150.241104,
                  150.571289,
                  150.901474,
                  151.231659,
                  151.561844,
                  151.940094,
                  152.274033,
                  152.607956,
                  152.941910,
                  153.263580,
                  153.591888,
                  153.920181,
                  154.248505,
                  154.613403,
                  154.941681,
                  155.269958,
                  155.598206,
                  155.926483,
                  156.298203,
                  156.626511,
                  156.954834,
                  157.283127,
                  157.633011,
                  157.961090,
                  158.289139,
                  158.617218,
                  158.945267,
                  159.285782,
                  159.611649,
                  159.937500,
                  160.263382,
                  160.610275,
                  160.936783,
                  161.263290,
                  161.589798,
                  161.916306,
                  162.284042,
                  162.608917,
                  162.933762,
                  163.258636,
                  163.597931,
                  163.922104,
                  164.246262,
                  164.570435,
                  164.894577,
                  165.256622,
                  165.581879,
                  165.907166,
                  166.232452,
                  166.595810,
                  166.921310,
                  167.246826,
                  167.572357,
                  167.897873,
                  168.178665,
                  168.504623,
                  168.830597,
                  169.156555,
                  169.507874,
                  169.834686,
                  170.161545,
                  170.488388,
                  170.815216,
                  171.328323,
                  171.655762,
                  171.983170,
                  172.310608,
                  172.556412,
                  172.884262,
                  173.212082,
                  173.539932,
                  174.078430,
                  174.408386,
                  174.738342,
                  175.068298,
                  175.442429,
                  175.775711,
                  176.109024,
                  176.442307,
                  176.775620,
                  177.126923,
                  177.459213,
                  177.791504,
                  178.123779,
                  178.510300,
                  178.841354,
                  179.172424,
                  179.503494,
                  179.906052,
                  180.239273,
                  180.572495,
                  180.905716,
                  181.238907,
                  181.569321,
                  181.901566,
                  182.233826,
                  182.566071,
                  183.066376,
                  183.399643,
                  183.732895,
                  184.066193,
                  184.366302 ]

export { track }
